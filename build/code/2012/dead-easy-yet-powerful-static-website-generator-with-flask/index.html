<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Dead easy yet powerful static website generator with Flask | Code | Nicolas Perriault</title>
    <meta name="description" content="Nicolas Perriault's homepage.">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="/static/packed.css?1331882038">
    <link rel="alternate" type="application/rss+xml" href="/code/feed/" title="Code (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/photography/feed/" title="Photography (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/talks/feed/" title="Talks (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/carnet/feed/" title="Carnet (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/feed/" title="Everything (RSS)">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="code ">
    <!--[if lt IE 7]>
    <p class="chromeframe">Your browser is <em>ancient!</em> Please <a href="http://www.quirksmode.org/upgrade.html">upgrade</a>.</p>
    <![endif]-->
    <div class="container">
        <header class="main-title">
            <h1><a href="/">Hi, I'm <strong>Nicolas.</strong></a></h1>
            <small>I code stuff. I take photos. I write rants.</small>
        </header>
        <div class="contents">
            

    <article lang="en" class="code" itemscope itemtype="http://schema.org/BlogPosting">
    <link itemprop="url" href="/code/2012/dead-easy-yet-powerful-static-website-generator-with-flask/">
    <header>
        <h2><a itemprop="name" href="/code/2012/dead-easy-yet-powerful-static-website-generator-with-flask/">Dead easy yet powerful static website generator with Flask</a></h2></header>
    
    <section>
        <p>It's been a long time I wanted to federate my online identities in a single, managed place â€” hence the website you're currently browsing. I've also been looking for a static website builder for some times, trying many and retaining zero. It was a bit depressing, frustrating to say the least.</p>
<p>Then I encountered <a href="https://twitter.com/#!/mitsuhiko/statuses/166570613295689728">this tweet by Armin Ronacher</a>:</p>
<blockquote class="twitter-tweet tw-align-center">
    <p>Frozen-Flask is really, really useful. Should have used that earlier.</p>&mdash; Armin Ronacher (@mitsuhiko) <a href="https://twitter.com/mitsuhiko/status/166570613295689728" data-datetime="2012-02-06T17:15:03+00:00">February 6, 2012</a>
</blockquote>

<p><a href="http://lucumr.pocoo.org/">Armin</a> is the author of <a href="http://flask.pocoo.org/">Flask</a>, a Python microframework I much appreciate for its simplicity, so this tweet immediately rang a bell and I started exploring the possibilities offered by <a href="http://packages.python.org/Frozen-Flask/">Frozen-Flask</a>.</p>
<p>Frozen-Flask basically <em>freezes</em> a Flask application into a set of static files, so you can host it without pain, but with speed. Combined with <a href="http://packages.python.org/Flask-FlatPages/">Flask-FlatPages</a>, you got the perfect set for generating your static website with everyting you could expect by using a framework:</p>
<ul>
<li>cool uris &amp; easy routing management</li>
<li>powerful templating</li>
<li>local, dynamic serving</li>
<li>static version generation</li>
</ul>
<h2>First iteration: project setup</h2>
<p>Create a brand new <a href="http://pypi.python.org/pypi/virtualenv">virtualenv</a> in a new directory and install the necessary packages using <a href="http://pypi.python.org/pypi/pip">pip</a>:</p>
<div class="codehilite"><pre>$ <span class="n">mkdir</span> <span class="n">sample_project</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> !$
$ <span class="n">mkvirtualenv</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span> `<span class="n">pwd</span>`<span class="o">/</span><span class="n">env</span>
$ <span class="n">source</span> <span class="n">env</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">activate</span>
$ <span class="n">pip</span> <span class="n">install</span> <span class="n">Flask</span> <span class="n">Frozen</span><span class="o">-</span><span class="n">Flask</span> <span class="n">Flask</span><span class="o">-</span><span class="n">FlatPages</span>
</pre></div>


<p>Write a very first version of our app in a <code>sitebuilder.py</code> file:</p>
<div class="codehilite"><pre><span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="p">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span>&quot;<span class="o">/</span>&quot;<span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">():</span>
    <span class="k">return</span> &quot;<span class="n">Hello</span> <span class="n">World</span>!&quot;

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> &quot;<span class="n">__main__</span>&quot;<span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="p">=</span>8000<span class="p">)</span>
</pre></div>


<p>Run it; you should see someting like:</p>
<div class="codehilite"><pre>$ <span class="n">python</span> <span class="n">sitebuilder</span><span class="p">.</span><span class="n">py</span>
 <span class="o">*</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span>127<span class="p">.</span>0<span class="p">.</span>0<span class="p">.</span>1<span class="p">:</span>8000<span class="o">/</span>
 <span class="o">*</span> <span class="n">Restarting</span> <span class="n">with</span> <span class="n">reloader</span>
</pre></div>


<p>Ensure with your browser that everyting is going fine by heading at <code>http://127.0.0.1:8000/</code>.</p>
<h2>New iteration: adding <em>flat pages</em></h2>
<p><a href="http://packages.python.org/Flask-FlatPages/">Flask-FlatPages</a> provides a collection of pages to your Flask application. Pages are built from <em>flat</em> text files as opposed to a relational database.</p>
<p>Create a <code>pages/</code> directory at the root of your project folder, and put a <code>hello-world.md</code> file in there:</p>
<div class="codehilite"><pre>$ <span class="n">mkdir</span> <span class="n">pages</span>
$ <span class="n">vi</span> <span class="n">pages</span><span class="o">/</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span><span class="p">.</span><span class="n">md</span>
</pre></div>


<p>The <code>pages/hello-world.md</code>:</p>
<pre class="unpretty"><code>title: Hello World
date: 2012-03-04

**Hello World**, from a *page*!
</code></pre>

<p>As you can see, we can write plain <a href="daringfireball.net/projects/markdown/">Mardown</a> for our page contents. So let's rewrite our app to serve any flatpage by its filename:</p>
<div class="codehilite"><pre><span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span>
<span class="n">from</span> <span class="n">flaskext</span><span class="p">.</span><span class="n">flatpages</span> <span class="n">import</span> <span class="n">FlatPages</span>

<span class="n">DEBUG</span> <span class="p">=</span> <span class="n">True</span>
<span class="n">FLATPAGES_AUTO_RELOAD</span> <span class="p">=</span> <span class="n">DEBUG</span>
<span class="n">FLATPAGES_EXTENSION</span> <span class="p">=</span> <span class="s">&#39;.md&#39;</span>

<span class="n">app</span> <span class="p">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">pages</span> <span class="p">=</span> <span class="n">FlatPages</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">():</span>
    <span class="k">return</span> &quot;<span class="n">Hello</span> <span class="n">World</span>&quot;

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&lt;path:path&gt;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">page</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pages</span><span class="p">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">html</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="p">=</span>8000<span class="p">)</span>
</pre></div>


<p>Now requesting <code>http://127.0.0.1:8000/hello-world/</code> will display our flatpage. Note that the markdown source is converted to html by getting the <code>html</code> property of our page object.</p>
<h2>New iteration: adding templates</h2>
<p>Flask uses the <a href="http://jinja.pocoo.org/docs/">Jinja2</a> template engine, so let's create some templates to decorate our pages. First create a <code>templates</code> directory at the root of the project:</p>
<div class="codehilite"><pre>$ <span class="n">mkdir</span> <span class="n">templates</span>
</pre></div>


<p>Create a base layout in <code>templates/base.html</code>:</p>
<div class="codehilite"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>My site<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s2">&quot;index&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>My site<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;</span>Default content to be displayed<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>Note the use of the <code>url_for()</code> template helper, that's the way we generate urls using Flask and Jinja2.</p>
<p>Now the <code>page.html</code> template to fill this layout with page contents:</p>
<div class="codehilite"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="nt">&lt;h2&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="nt">&lt;/h2&gt;</span>
    <span class="cp">{{</span> <span class="nv">page.html</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">content</span> <span class="cp">%}</span>
</pre></div>


<p>Our app is now:</p>
<div class="codehilite"><pre><span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>
<span class="n">from</span> <span class="n">flaskext</span><span class="p">.</span><span class="n">flatpages</span> <span class="n">import</span> <span class="n">FlatPages</span>

<span class="n">DEBUG</span> <span class="p">=</span> <span class="n">True</span>
<span class="n">FLATPAGES_AUTO_RELOAD</span> <span class="p">=</span> <span class="n">DEBUG</span>
<span class="n">FLATPAGES_EXTENSION</span> <span class="p">=</span> <span class="s">&#39;.md&#39;</span>

<span class="n">app</span> <span class="p">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">pages</span> <span class="p">=</span> <span class="n">FlatPages</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">():</span>
    <span class="k">return</span> &quot;<span class="n">Hello</span> <span class="n">World</span>&quot;

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&lt;path:path&gt;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">page</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">page</span> <span class="p">=</span> <span class="n">pages</span><span class="p">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;page.html&#39;</span><span class="p">,</span> <span class="n">page</span><span class="p">=</span><span class="n">page</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="p">=</span>8000<span class="p">)</span>
</pre></div>


<p>Hell, what did we just do?</p>
<ul>
<li>we created templates for our app; a common layout (<code>base.html</code>) and a page template (<code>page.html</code>)</li>
<li>we used the <code>render_template</code> function to use the page template for decorating our pages</li>
<li>the page template extends the base one to avoid copying and pasting stuff for every page on Earth</li>
</ul>
<h2>New iteration: display the list of available pages on the homepage</h2>
<p>For now our homepage has been a bit sick, to say the least. Let's make it an index of all available pages.</p>
<p>Create a <code>templates/index.html</code> with the following contents:</p>
<div class="codehilite"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="nt">&lt;h2&gt;</span>List of stuff<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page</span> <span class="k">in</span> <span class="nv">pages</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s2">&quot;page&quot;</span><span class="o">,</span> <span class="nv">path</span><span class="o">=</span><span class="nv">page.path</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;</span>No stuff.<span class="nt">&lt;/li&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">content</span> <span class="cp">%}</span>
</pre></div>


<p>Feel free to create more flat pages, the same way we did with <code>hello-world.md</code>, storing the file into the <code>pages/</code> directory using the <code>.md</code> extension.</p>
<p>So the <code>index()</code> route of our app is now:</p>
<div class="codehilite"><pre><span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">pages</span><span class="p">=</span><span class="n">pages</span><span class="p">)</span>
</pre></div>


<p>If you reload the homepage, a list of all available flatpages is displayed with a link for each. Damn, that was pretty easy.</p>
<h2>New iteration: adding metadata to pages</h2>
<p>Flask-FlatPages allows to enter metadata for pages the same way we did for the title and the creation date with our <code>hello-world.md</code>, and access them using the <code>page.meta</code> property, which contains a plain silly python dict. That's pretty awesome when you think about it, heh?</p>
<p>So let's imagine you want tags for your pages, our <code>hello-world.md</code> becomes:</p>
<pre class="unpretty"><code>title: Hello World
date: 2012-03-04
tags: [general, awesome, stuff]

**Hello World**, from a *page*!
</code></pre>

<p>For the records, metadata are described in <a href="http://yaml.org/">YAML</a>, so you can use strings, booleans, integers, floats, lists and even dicts which will be converted to their respective native Python equivalent.</p>
<p>We're going to use two different templates for listing general pages and tagged ones, using a shared template partial. Our <code>index.html</code> is now:</p>
<div class="codehilite"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="nt">&lt;h2&gt;</span>List of stuff<span class="nt">&lt;/h2&gt;</span>
    <span class="cp">{%</span> <span class="k">with</span> <span class="nv">pages</span><span class="o">=</span><span class="nv">pages</span>  <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;_list.html&quot;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">content</span> <span class="cp">%}</span>
</pre></div>


<p>Create a new <code>tag.html</code> template, which will display the list of tagged pages:</p>
<div class="codehilite"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="nt">&lt;h2&gt;</span>List of stuff tagged <span class="nt">&lt;em&gt;</span><span class="cp">{{</span> <span class="nv">tag</span> <span class="cp">}}</span><span class="nt">&lt;/em&gt;&lt;/h2&gt;</span>
    <span class="cp">{%</span> <span class="k">with</span> <span class="nv">pages</span><span class="o">=</span><span class="nv">pages</span>  <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;_list.html&quot;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">content</span> <span class="cp">%}</span>
</pre></div>


<p>The new <code>_list.html</code> template we need for inclusion contains:</p>
<div class="codehilite"><pre><span class="nt">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">page</span> <span class="k">in</span> <span class="nv">pages</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s2">&quot;page&quot;</span><span class="o">,</span> <span class="nv">path</span><span class="o">=</span><span class="nv">page.path</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page.title</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page.meta.tags</span><span class="o">|</span><span class="nf">length</span> <span class="cp">%}</span>
        | Tagged:
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_tag</span> <span class="k">in</span> <span class="nv">page.meta.tags</span> <span class="cp">%}</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s2">&quot;tag&quot;</span><span class="o">,</span> <span class="nv">tag</span><span class="o">=</span><span class="nv">page_tag</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page_tag</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span>No page.<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>


<p>Let's add a new <code>tag</code> route to our app, to use our new <code>tag.html</code> template:</p>
<div class="codehilite"><pre><span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/tag/&lt;string:tag&gt;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">tag</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
    <span class="n">tagged</span> <span class="p">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="n">in</span> <span class="n">pages</span> <span class="k">if</span> <span class="n">tag</span> <span class="n">in</span> <span class="n">p</span><span class="p">.</span><span class="n">meta</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;tag.html&#39;</span><span class="p">,</span> <span class="n">pages</span><span class="p">=</span><span class="n">tagged</span><span class="p">,</span> <span class="n">tag</span><span class="p">=</span><span class="n">tag</span><span class="p">)</span>
</pre></div>


<p><strong>Note:</strong> if you didn't like Python's <a href="http://www.network-theory.co.uk/docs/pytut/ListComprehensions.html">list comprehensions</a> yet, now you do.</p>
<h2>New iteration: generate the static stuff</h2>
<p>Well, for now we only have a dynamic website, which uses and serves flatpages stored on the filesystem: CRAP. But the idea's of course not to host a Flask app but a set of static files and assets to skip the need of any application server.</p>
<p>Here enters Frozen-Flask. Its use is damn easy:</p>
<div class="codehilite"><pre><span class="n">import</span> <span class="n">sys</span>

<span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>
<span class="n">from</span> <span class="n">flaskext</span><span class="p">.</span><span class="n">flatpages</span> <span class="n">import</span> <span class="n">FlatPages</span>
<span class="n">from</span> <span class="n">flask_frozen</span> <span class="n">import</span> <span class="n">Freezer</span>

<span class="n">DEBUG</span> <span class="p">=</span> <span class="n">True</span>
<span class="n">FLATPAGES_AUTO_RELOAD</span> <span class="p">=</span> <span class="n">DEBUG</span>
<span class="n">FLATPAGES_EXTENSION</span> <span class="p">=</span> <span class="s">&#39;.md&#39;</span>

<span class="n">app</span> <span class="p">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">pages</span> <span class="p">=</span> <span class="n">FlatPages</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">freezer</span> <span class="p">=</span> <span class="n">Freezer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">pages</span><span class="p">=</span><span class="n">pages</span><span class="p">)</span>

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/tag/&lt;string:tag&gt;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">tag</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
    <span class="n">tagged</span> <span class="p">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="n">in</span> <span class="n">pages</span> <span class="k">if</span> <span class="n">tag</span> <span class="n">in</span> <span class="n">p</span><span class="p">.</span><span class="n">meta</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;tag.html&#39;</span><span class="p">,</span> <span class="n">pages</span><span class="p">=</span><span class="n">tagged</span><span class="p">,</span> <span class="n">tag</span><span class="p">=</span><span class="n">tag</span><span class="p">)</span>

<span class="p">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&lt;path:path&gt;/&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">page</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">page</span> <span class="p">=</span> <span class="n">pages</span><span class="p">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;page.html&#39;</span><span class="p">,</span> <span class="n">page</span><span class="p">=</span><span class="n">page</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> 1 <span class="n">and</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span>1<span class="p">]</span> <span class="o">==</span> &quot;<span class="n">build</span>&quot;<span class="p">:</span>
        <span class="n">freezer</span><span class="p">.</span><span class="n">freeze</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="p">=</span>8000<span class="p">)</span>
</pre></div>


<p>And run:</p>
<div class="codehilite"><pre>$ <span class="n">python</span> <span class="n">sitebuilder</span><span class="p">.</span><span class="n">py</span> <span class="n">build</span>
</pre></div>


<p>Open the <code>build</code> folder generated by this command:</p>
<div class="codehilite"><pre>$ <span class="n">tree</span>
<span class="p">.</span>
â”œâ”€â”€ <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
â”‚Â Â  â””â”€â”€ <span class="n">index</span><span class="p">.</span><span class="n">html</span>
â”œâ”€â”€ <span class="n">index</span><span class="p">.</span><span class="n">html</span>
â””â”€â”€ <span class="n">tag</span>
    â”œâ”€â”€ <span class="n">awesome</span>
    â”‚Â Â  â””â”€â”€ <span class="n">index</span><span class="p">.</span><span class="n">html</span>
    â”œâ”€â”€ <span class="n">general</span>
    â”‚Â Â  â””â”€â”€ <span class="n">index</span><span class="p">.</span><span class="n">html</span>
    â””â”€â”€ <span class="n">stuff</span>
        â””â”€â”€ <span class="n">index</span><span class="p">.</span><span class="n">html</span>

5 <span class="n">directories</span><span class="p">,</span> 5 <span class="n">files</span>
</pre></div>


<p><strong>MIND: BLOWN.</strong></p>
<p>You can now deploy the contents of this <code>build</code> directory to any webserver which's able to serve static files, and you're done. With just 34 lines of manually written Python codeâ€¦ not bad heh?</p>
<p>Of course, our website is pretty crappy right now, but you should be get started to add features on your own, now.</p>
    </section>
    <aside>
        <p>
            <span class="article-author" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <span itemprop="name">Nicolas Perriault</span> â€”
            </span>
            <time datetime="2012-03-04" itemprop="datePublished">2012-03-04</time>
            â€” in <a href="/code/" itemprop="genre">Code</a>
            â€” <a href="/code/2012/dead-easy-yet-powerful-static-website-generator-with-flask/">Permalink</a>
            â€” <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">License</a>.
        </p>
    </aside>
    <hr>
    <nav>
        <a class="prev" href="/code/2012/introducing-casperjs-toolkit-phantomjs/">CasperJS, a toolkit on top of PhantomJS</a>
        |
        <a class="next" href="/code/2012/gandi-standard-ssl-certificate-nginx/">Gandi Standard SSL Certificate &amp; Nginx</a>
    </nav>
</article>


        </div>
        <nav class="sidebar">
            <ul>
                <li class="home"><a href="/" hreflang="en">Home</a></li>
                <li class="code"><a href="/code/" hreflang="en">Code</a></li>
                <li class="photography"><a href="/photography/" hreflang="en">Photography</a></li>
                <li class="talks"><a href="/talks/" hreflang="en">Talks</a></li>
                <li class="carnet"><a href="/carnet/" hreflang="fr">Carnet <span>fr</span></a></li>
                <li class="contact"><a href="/contact/" hreflang="en">Contact</a></li>
            </ul>
        </nav>
        <footer class="site-footer">
            <p>
                &copy; 2012 Nicolas Perriault
                â€” <a href="https://twitter.com/n1k0">Tweet at me</a>
                â€” <a href="https://github.com/n1k0">Get my code</a>
                â€” <a href="http://500px.com/n1k0">Enjoy my pics</a>
                â€” <a href="/contact/">Contact me</a>
            </p>
        </footer>
    </div>
    <!-- /container -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.min.js"><\/script>')</script>
    <script type="text/javascript" src="/static/packed.js?1331882039"></script>
    <script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</body>
</html>