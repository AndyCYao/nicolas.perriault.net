<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Gandi Standard SSL Certificate &amp; Nginx | Code | Nicolas Perriault</title>
    <meta name="description" content="Nicolas Perriault's homepage.">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="/static/packed.css?1331656984">
    <link rel="alternate" type="application/rss+xml" href="/code/feed/" title="Code (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/photography/feed/" title="Photography (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/talks/feed/" title="Talks (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/carnet/feed/" title="Carnet (RSS)">
    <link rel="alternate" type="application/rss+xml" href="/feed/" title="Everything (RSS)">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="code ">
    <!--[if lt IE 7]>
    <p class="chromeframe">Your browser is <em>ancient!</em> Please <a href="http://www.quirksmode.org/upgrade.html">upgrade</a>.</p>
    <![endif]-->
    <div class="container">
        <header class="main-title">
            <h1><a href="/">Hi, I'm <strong>Nicolas.</strong></a></h1>
            <small>I code stuff. I take photos. I write rants.</small>
        </header>
        <div class="contents">
            

    <article lang="en" class="code" itemscope itemtype="http://schema.org/BlogPosting">
    <link itemprop="url" href="/code/2012/gandi-standard-ssl-certificate-nginx/">
    <header>
        <h2><a itemprop="name" href="/code/2012/gandi-standard-ssl-certificate-nginx/">Gandi Standard SSL Certificate &amp; Nginx</a></h2></header>
    
    <section>
        <p><a href="http://gandi.net/">Gandi</a> offers a <a href="http://wiki.gandi.net/en/ssl/free">free SSL certificate</a> during one year for any domain you buy there, nice. But the setup is a bit tedious and the documentation a bit disparate, so here's an attempt for a comprehensive howto for configuring a secured <a href="http://nginx.org/">nginx</a> vhost using your <em>free</em> certificate.</p>
<p><strong>Disclaimer:</strong> <em>Gandi's quite complicated email confirmation and validation worflow won't be covered in this post. Just ensure you can receive emails at <code>admin@domain.tld</code> where <code>domain.tld</code> is your domain.</em></p>
<h2>Creating your certificate</h2>
<p>On your server, ensure you have the <a href="http://openssl.org/"><code>openssl</code></a> command available or install it. Then, <a href="http://wiki.gandi.net/en/ssl/csr">generate your CSR</a> (<code>domain.tld</code> is your actual domain):</p>
<div class="codehilite"><pre>$ <span class="n">openssl</span> <span class="n">req</span> <span class="o">-</span><span class="n">nodes</span> <span class="o">-</span><span class="n">newkey</span> <span class="n">rsa</span><span class="p">:</span>2048 <span class="o">-</span><span class="n">keyout</span> <span class="n">domain</span><span class="p">.</span><span class="n">tld</span><span class="p">.</span><span class="n">key</span> <span class="o">\</span>
    <span class="o">-</span><span class="n">out</span> <span class="n">domain</span><span class="p">.</span><span class="n">tld</span><span class="p">.</span><span class="n">csr</span>
</pre></div>


<p>Answer a few questions from the program, but here's the most important bit: <strong>enter your domain or subdomain when prompted to provide a <em>Common Name</em></strong>:</p>
<div class="codehilite"><pre><span class="n">Common</span> <span class="n">Name</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="n">YOUR</span> <span class="n">name</span><span class="p">)</span> <span class="p">[]:</span> <span class="n">domain</span><span class="p">.</span><span class="n">tld</span>
</pre></div>


<p>As they say:</p>
<blockquote>
<p>The process will create 2 files: a public <code>.csr</code> file, and a private <code>.key</code> file which you must absolutely keep private.</p>
</blockquote>
<p><strong>Note:</strong> <em>Alas, you won't be able to extend your certicate to all possible subdomains using a wildcard as it is <a href="http://wiki.gandi.net/questions/fr/ssl/csr/multi-domaine-non-accepte">only supported starting with their <em>«Pro»</em> offer</a>.</em></p>
<p>Have a coffee.</p>
<hr />
<h2>Enter <del>Sandman</del> Franz Kafka</h2>
<p>Next, head to your <a href="https://www.gandi.net/admin/domain">Gandi domain management page</a>, select your domain, click on  <em>SSL Certificate: Manage</em>, click on <em>Activate this certificate</em> then Paste the content of the generated <code>domain.tld.csr</code> file into the textarea and submit the form. Then wait for some email from Gandi to confirm your demand.</p>
<p>In the meanwhile, <a href="http://wiki.gandi.net/en/ssl/intermediate">retrieve the intermediate certificate</a> from the <a href="https://www.gandi.net/admin/ssl/manage">SSL certificate management page</a> of your Gandi account, clicking on the tiny magnifying glass next to your domain name (the one with a nicely hidden <em>«Get the certificate»</em> tooltip on rollover); you'll get both the certificate and <em>Gandi's operational certificate authority</em> files:</p>
<ul>
<li><code>cert-domain.tld.pem</code>, where <code>domain.tld</code> is your actual domain</li>
<li><code>GandiStandardSSLCA.pem</code></li>
</ul>
<p>Upload them both to your server, store them in eg. <code>/etc/nginx/certificates/</code> (nope, this directory is unlikely to exist by default; do as you like).</p>
<p>Last, you have to append the Gandi CA to your domain certificate:</p>
<div class="codehilite"><pre>$ <span class="nb">cat</span> <span class="n">GandiStandardSSLCA</span><span class="p">.</span><span class="n">pem</span> <span class="o">&gt;&gt;</span> <span class="n">cert</span><span class="o">-</span><span class="n">domain</span><span class="p">.</span><span class="n">tld</span><span class="p">.</span><span class="n">crt</span>
</pre></div>


<p>Have a capuccino.</p>
<hr />
<h2>Configuring the nginx vhost</h2>
<p>Here's a sample vhost server configuration for nginx, kept as concise as possible for the sake of brevity and clarity:</p>
<div class="codehilite"><pre><span class="n">server</span> <span class="p">{</span>
    <span class="n">listen</span> 443<span class="p">;</span>
    <span class="n">server_name</span> &quot;<span class="n">domain</span><span class="p">.</span><span class="n">tld</span>&quot;<span class="p">;</span>
    <span class="n">root</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">your_website_root</span><span class="p">;</span>

    <span class="n">ssl</span> <span class="n">on</span><span class="p">;</span>
    <span class="n">ssl_certificate</span>     <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">certificates</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">domain</span><span class="p">.</span><span class="n">tld</span><span class="p">.</span><span class="n">crt</span><span class="p">;</span>
    <span class="n">ssl_certificate_key</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">certificates</span><span class="o">/</span><span class="n">domain</span><span class="p">.</span><span class="n">tld</span><span class="p">.</span><span class="n">key</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Restart nginx and you should be able to access your website using <code>https://domain.tld/</code>.</p>
<p>To redirect all HTTP trafic to HTTPS for this server, add this:</p>
<div class="codehilite"><pre><span class="n">server</span> <span class="p">{</span>
    <span class="n">listen</span> 80<span class="p">;</span>
    <span class="n">server_name</span> &quot;<span class="n">domain</span><span class="p">.</span><span class="n">tld</span>&quot;<span class="p">;</span>
    <span class="n">rewrite</span> ^<span class="p">(</span><span class="o">.*</span><span class="p">)</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span>$<span class="n">host</span>$1 <span class="n">permanent</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Have a latte.</p>
<h2>Conclusion</h2>
<p>At this point, you should be seriously considering quitting caffeine. As a positive note, it looks like the whole process will be revamped in <em>some weeks</em>:</p>
<blockquote class="twitter-tweet tw-align-center" data-in-reply-to="174864441731588096">
    <p>@<a href="https://twitter.com/n1k0">n1k0</a> browsers (ff and others) allow us to validate via a DNS entry we will change the workflow in some weeks when we'll put it in the API.</p>&mdash; gandi.net (@gandi_net) <a href="https://twitter.com/gandi_net/status/174909743612166144" data-datetime="2012-02-29T17:31:47+00:00">February 29, 2012</a>
</blockquote>

<p>If you're looking for other alternatives than Gandi for getting SSL certs, it seems that many people are speaking well of <a href="http://www.startssl.com/">StartSSL</a> despite their ugly site, but I didn't use the service myself.</p>
<hr />
<h2>References</h2>
<ul>
<li><a href="http://wiki.gandi.net/en/ssl">Gandi SSL wiki pages</a></li>
<li><a href="http://www.informathic.com/post/2010/12/24/installer-ssl-gandi-nginx">Installer un certificat Gandi SSL Standard sur Nginx</a> (French)</li>
</ul>
    </section>
    <aside>
        <p>
            <span class="article-author" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <span itemprop="name">Nicolas Perriault</span> —
            </span>
            <time datetime="2012-02-29" itemprop="datePublished">2012-02-29</time>
            — in <a href="/code/" itemprop="genre">Code</a>
            — <a href="/code/2012/gandi-standard-ssl-certificate-nginx/">Permalink</a>
            — <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">License</a>.
        </p>
    </aside>
    <hr>
    <nav>
        <a class="prev" href="/code/2012/dead-easy-yet-powerful-static-website-generator-with-flask/">Dead easy yet powerful static website generator with Flask</a>
        |
        <a class="next" href="/code/2011/setup-jenkins-github-private-repository-ubuntu/">Setup Jenkins for working with a private Github repository</a>
    </nav>
</article>


        </div>
        <nav class="sidebar">
            <ul>
                <li class="home"><a href="/" hreflang="en">Home</a></li>
                <li class="code"><a href="/code/" hreflang="en">Code</a></li>
                <li class="photography"><a href="/photography/" hreflang="en">Photography</a></li>
                <li class="talks"><a href="/talks/" hreflang="en">Talks</a></li>
                <li class="carnet"><a href="/carnet/" hreflang="fr">Carnet <span>fr</span></a></li>
                <li class="contact"><a href="/contact/" hreflang="en">Contact</a></li>
            </ul>
        </nav>
        <footer class="site-footer">
            <p>
                &copy; 2012 Nicolas Perriault
                — <a href="https://twitter.com/n1k0">Tweet at me</a>
                — <a href="https://github.com/n1k0">Get my code</a>
                — <a href="http://500px.com/n1k0">Enjoy my pics</a>
                — <a href="/contact/">Contact me</a>
            </p>
        </footer>
    </div>
    <!-- /container -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.min.js"><\/script>')</script>
    <script type="text/javascript" src="/static/packed.js?1331026602"></script>
    <script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</body>
</html>